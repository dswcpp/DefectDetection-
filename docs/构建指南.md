# 构建指南

> 现状说明：仓库没有 CMakeLists.txt，也没有自动打包脚本，工程使用 **qmake/Qt Creator**。下面给出基于 qmake 的构建方法。

---

## 1. 环境准备

### 1.1 依赖

| 依赖 | 版本 | 必需 | 说明 |
| --- | --- | --- | --- |
| Qt | 6.5+ | 是 | 提供 qmake、windeployqt、UI 框架 |
| OpenCV | 4.6+ | 是 | 图像处理 |
| spdlog | 1.10+ | 是 | 日志 |
| nlohmann/json | 3.11+ | 是 | JSON 解析 |
| libmodbus | 3.1+ | 按需 | PLC 通信 |
| 海康 MVS / 大恒 Galaxy | 与设备匹配 | 按需 | 相机 SDK |

### 1.2 编译器与工具链
- Windows：MinGW 64-bit（Qt 自带）或 MSVC 2019/2022 + 对应 Qt Kit。
- Linux：GCC 11+ / Clang 13+，qmake 来自 Qt 安装目录。
- 建议 Release 或 RelWithDebInfo，Debug 仅用于调试。

---

## 2. Windows 构建（qmake）

### 2.1 Qt Creator（推荐）
1. 用 Qt Creator 打开 `DefectDetection.pro`。
2. 选择 Kit：`Desktop Qt 6.x.x MinGW 64-bit` 或 `MSVC 64-bit`。
3. 构建配置选 **Release**，点击构建。
4. 生成物在 `build/<Kit>/src/app/DefectDetection.exe`。

### 2.2 命令行（MinGW 例）
```powershell
mkdir build && cd build
qmake -r ..\DefectDetection.pro CONFIG+=release -spec win32-g++
mingw32-make -j8
```

### 2.3 部署运行库
```powershell
# 在构建目录执行，收集 Qt 依赖
autodeploy="build\\Desktop_Qt_6_8_1_MinGW_64_bit-Release"
windeployqt "$autodeploy\\src\\app\\DefectDetection.exe"
```
如需 OpenCV/其他 SDK DLL，请手工拷贝到可执行所在目录或放入 PATH。

---

## 3. Linux 构建（qmake）

### 3.1 安装依赖（Ubuntu 例）
```bash
sudo apt update
sudo apt install -y build-essential qt6-base-dev qt6-tools-dev libopencv-dev \
    libspdlog-dev nlohmann-json3-dev libmodbus-dev
```

### 3.2 构建
```bash
mkdir -p build && cd build
qmake -r ../DefectDetection.pro CONFIG+=release
make -j$(nproc)
```

### 3.3 运行
```bash
./src/app/DefectDetection
```
如需打包，请将可执行与 Qt/OpenCV 运行库、`config/` 等资源放入同级目录后再压缩。

---

## 4. 构建产物位置
- 可执行：`build/<Kit>/src/app/DefectDetection[.exe]`
- 模块库：`build/<Kit>/src/<module>/` 下的 `.a/.dll/.so`（当前仓库生成的库名带数字后缀属于调试产物，可按需清理）。

---

## 5. 常见问题
- **提示找不到 Qt**：使用 Qt Creator 配置正确的 Kit，或设置 `QTDIR`/`PATH` 指向 Qt 的 `bin`。
- **OpenCV 链接失败**：确认 OpenCV include 与 lib 路径在 `INCLUDEPATH`/`LIBS` 中，或通过 vcpkg 安装后追加到 PATH。
- **运行缺少 DLL**：Release 后用 `windeployqt` 收集 Qt 依赖，再把 OpenCV/SDK DLL 放到同一目录。
- **MinGW 与 MSVC 混用**：保持编译器与依赖一致，避免交叉链接。
