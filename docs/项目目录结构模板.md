# é¡¹ç›®ç›®å½•ç»“æ„æ¨¡æ¿

> **ä¸€é”®ç”Ÿæˆ**ï¼šå¯ç›´æ¥å¤åˆ¶ä¸‹æ–¹ Shell è„šæœ¬åˆ›å»ºå®Œæ•´ç›®å½•ç»“æ„ã€‚
> 

---

## 1. ç›®å½•ç»“æ„æ€»è§ˆ

```
defect-inspector/
â”œâ”€â”€ ğŸ“ cmake/                      # CMake æ¨¡å—ä¸å·¥å…·é“¾
â”‚   â”œâ”€â”€ FindOpenCV.cmake
â”‚   â”œâ”€â”€ FindQt6.cmake
â”‚   â”œâ”€â”€ toolchain-aarch64.cmake    # ARM äº¤å‰ç¼–è¯‘å·¥å…·é“¾
â”‚   â””â”€â”€ version.cmake              # ç‰ˆæœ¬å·ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ“ src/                         # æºä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ app/                     # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â”‚   â”œâ”€â”€ main.cpp
â”‚   â”‚   â”œâ”€â”€ Application.h/cpp      # åº”ç”¨ç¨‹åºç±»
â”‚   â”‚   â””â”€â”€ [version.h.in](http://version.h.in)           # ç‰ˆæœ¬ä¿¡æ¯æ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ core/                    # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ DetectPipeline.h/cpp   # æ£€æµ‹æµæ°´çº¿
â”‚   â”‚   â”œâ”€â”€ DefectJudge.h/cpp      # ç¼ºé™·åˆ¤å®šå™¨
â”‚   â”‚   â”œâ”€â”€ ResultManager.h/cpp    # ç»“æœç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ BatchManager.h/cpp     # æ‰¹æ¬¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ WorkflowController.h/cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ algorithm/               # ç®—æ³•å¼•æ“å±‚
â”‚   â”‚   â”œâ”€â”€ IDefectDetector.h      # æ£€æµ‹å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ ScratchDetector.h/cpp  # åˆ’ç—•æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ CrackDetector.h/cpp    # è£‚çº¹æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ ForeignDetector.h/cpp  # å¼‚ç‰©æ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ DimensionDetector.h/cpp # å°ºå¯¸æµ‹é‡
â”‚   â”‚   â”œâ”€â”€ DnnDetector.h/cpp      # DNN æ£€æµ‹å™¨
â”‚   â”‚   â”œâ”€â”€ DefectScorer.h/cpp     # ä¸¥é‡åº¦è¯„åˆ†
â”‚   â”‚   â”œâ”€â”€ ImagePreprocessor.h/cpp # å›¾åƒé¢„å¤„ç†
â”‚   â”‚   â””â”€â”€ ROIManager.h/cpp       # ROI ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ hal/                     # ç¡¬ä»¶æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ ICamera.h              # ç›¸æœºæ¥å£
â”‚   â”‚   â”œâ”€â”€ HikCamera.h/cpp        # æµ·åº·ç›¸æœºå®ç°
â”‚   â”‚   â”œâ”€â”€ BaslerCamera.h/cpp     # Basler ç›¸æœºå®ç°
â”‚   â”‚   â”œâ”€â”€ MockCamera.h/cpp       # æ¨¡æ‹Ÿç›¸æœºï¼ˆæµ‹è¯•ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ ILightController.h     # å…‰æºæ¥å£
â”‚   â”‚   â”œâ”€â”€ SerialLight.h/cpp      # ä¸²å£å…‰æºæ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ IIOController.h        # IO æ¥å£
â”‚   â”‚   â”œâ”€â”€ ModbusTCPClient.h/cpp  # Modbus TCP
â”‚   â”‚   â””â”€â”€ PLCController.h/cpp    # PLC æ§åˆ¶å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ ui/                      # Qt6 ç•Œé¢å±‚
â”‚   â”‚   â”œâ”€â”€ MainWindow.h/cpp       # ä¸»çª—å£
â”‚   â”‚   â”œâ”€â”€ MainWindow.ui
â”‚   â”‚   â”œâ”€â”€ ğŸ“ widgets/             # è‡ªå®šä¹‰æ§ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageView.h/cpp    # å›¾åƒæ˜¾ç¤ºæ§ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ ROIEditor.h/cpp    # ROI ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ResultCard.h/cpp   # ç»“æœå¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ ParamPanel.h/cpp   # å‚æ•°é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ SeverityBar.h/cpp  # ä¸¥é‡åº¦è¿›åº¦æ¡
â”‚   â”‚   â”‚   â””â”€â”€ StatisticsChart.h/cpp # ç»Ÿè®¡å›¾è¡¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“ dialogs/             # å¯¹è¯æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ CalibrationDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ UserManageDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ HistoryDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ AlarmDialog.h/cpp
â”‚   â”‚   â”‚   â”œâ”€â”€ ModelManageDialog.h/cpp
â”‚   â”‚   â”‚   â””â”€â”€ AboutDialog.h/cpp
â”‚   â”‚   â””â”€â”€ ğŸ“ views/               # åŠŸèƒ½è§†å›¾
â”‚   â”‚       â”œâ”€â”€ StatisticsView.h/cpp
â”‚   â”‚       â”œâ”€â”€ HistoryView.h/cpp
â”‚   â”‚       â””â”€â”€ SPCView.h/cpp
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ data/                    # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ DatabaseManager.h/cpp  # æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ InspectionDAO.h/cpp    # æ£€æµ‹è®°å½• DAO
â”‚   â”‚   â”œâ”€â”€ DefectDAO.h/cpp        # ç¼ºé™· DAO
â”‚   â”‚   â”œâ”€â”€ UserDAO.h/cpp          # ç”¨æˆ· DAO
â”‚   â”‚   â”œâ”€â”€ ConfigDAO.h/cpp        # é…ç½® DAO
â”‚   â”‚   â”œâ”€â”€ AuditLogger.h/cpp      # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â””â”€â”€ DataExporter.h/cpp     # æ•°æ®å¯¼å‡º
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ network/                 # ç½‘ç»œé€šä¿¡
â”‚   â”‚   â”œâ”€â”€ MESClient.h/cpp        # MES å¯¹æ¥
â”‚   â”‚   â”œâ”€â”€ WebSocketServer.h/cpp  # WebSocket æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ RESTServer.h/cpp       # REST API
â”‚   â”‚   â””â”€â”€ RemoteDiagnostic.h/cpp # è¿œç¨‹è¯Šæ–­
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ common/                  # å…¬å…±æ¨¡å—
â”‚       â”œâ”€â”€ Logger.h/cpp           # æ—¥å¿—å°è£… (spdlog)
â”‚       â”œâ”€â”€ ConfigManager.h/cpp    # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ ConfigValidator.h/cpp  # é…ç½®æ ¡éªŒ
â”‚       â”œâ”€â”€ SPSCQueue.h            # æ— é”é˜Ÿåˆ—
â”‚       â”œâ”€â”€ ThreadPool.h           # çº¿ç¨‹æ± 
â”‚       â”œâ”€â”€ SystemWatchdog.h/cpp   # çœ‹é—¨ç‹—
â”‚       â”œâ”€â”€ PerformanceProfiler.h/cpp # æ€§èƒ½ç»Ÿè®¡
â”‚       â”œâ”€â”€ ImageUtils.h/cpp       # å›¾åƒå·¥å…·
â”‚       â”œâ”€â”€ FileUtils.h/cpp        # æ–‡ä»¶å·¥å…·
â”‚       â”œâ”€â”€ CryptoUtils.h/cpp      # åŠ å¯†å·¥å…·
â”‚       â””â”€â”€ Types.h                # å…¬å…±ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ ğŸ“ include/                     # å…¬å…±å¤´æ–‡ä»¶ï¼ˆå¯¹å¤–æ¥å£ï¼‰
â”‚   â””â”€â”€ defect_inspector/
â”‚       â”œâ”€â”€ export.h               # å¯¼å‡ºå®
â”‚       â”œâ”€â”€ types.h                # å…¬å…±ç±»å‹
â”‚       â””â”€â”€ api.h                  # C APIï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ default.json               # é»˜è®¤é…ç½®
â”‚   â”œâ”€â”€ camera_hik.json            # æµ·åº·ç›¸æœºé…ç½®
â”‚   â”œâ”€â”€ camera_basler.json         # Basler ç›¸æœºé…ç½®
â”‚   â”œâ”€â”€ detectors.json             # æ£€æµ‹å™¨å‚æ•°
â”‚   â”œâ”€â”€ severity.json              # ä¸¥é‡åº¦é˜ˆå€¼
â”‚   â”œâ”€â”€ plc_registers.json         # PLC å¯„å­˜å™¨æ˜ å°„
â”‚   â””â”€â”€ ğŸ“ templates/               # é…ç½®æ¨¡æ¿
â”‚       â”œâ”€â”€ product_A.json
â”‚       â””â”€â”€ product_B.json
â”‚
â”œâ”€â”€ ğŸ“ models/                      # AI æ¨¡å‹
â”‚   â”œâ”€â”€ yolov5n_defect_v1.0.onnx
â”‚   â”œâ”€â”€ yolov5n_defect_v1.1.onnx
â”‚   â””â”€â”€ model_info.json            # æ¨¡å‹å…ƒä¿¡æ¯
â”‚
â”œâ”€â”€ ğŸ“ resources/                   # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ icons/                   # å›¾æ ‡
â”‚   â”‚   â”œâ”€â”€ app.ico
â”‚   â”‚   â”œâ”€â”€ ok.svg
â”‚   â”‚   â”œâ”€â”€ ng.svg
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ ğŸ“ images/                  # å›¾ç‰‡
â”‚   â”‚   â”œâ”€â”€ splash.png
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â”œâ”€â”€ ğŸ“ qss/                     # Qt æ ·å¼è¡¨
â”‚   â”‚   â”œâ”€â”€ light.qss
â”‚   â”‚   â””â”€â”€ dark.qss
â”‚   â”œâ”€â”€ ğŸ“ translations/            # å¤šè¯­è¨€
â”‚   â”‚   â”œâ”€â”€ app_zh_CN.ts
â”‚   â”‚   â”œâ”€â”€ app_en_US.ts
â”‚   â”‚   â””â”€â”€ app_zh_CN.qm
â”‚   â””â”€â”€ resources.qrc              # Qt èµ„æºæ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ scripts/                     # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ ğŸ“ build/                   # æ„å»ºè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ build_[linux.sh](http://linux.sh)
â”‚   â”‚   â”œâ”€â”€ build_windows.bat
â”‚   â”‚   â”œâ”€â”€ build_[arm.sh](http://arm.sh)
â”‚   â”‚   â””â”€â”€ [package.sh](http://package.sh)             # æ‰“åŒ…è„šæœ¬
â”‚   â”œâ”€â”€ ğŸ“ deploy/                  # éƒ¨ç½²è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ [install.sh](http://install.sh)
â”‚   â”‚   â”œâ”€â”€ [uninstall.sh](http://uninstall.sh)
â”‚   â”‚   â”œâ”€â”€ [backup.sh](http://backup.sh)
â”‚   â”‚   â””â”€â”€ [restore.sh](http://restore.sh)
â”‚   â”œâ”€â”€ ğŸ“ tools/                   # å·¥å…·è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ db_[migrate.py](http://migrate.py)          # æ•°æ®åº“è¿ç§»
â”‚   â”‚   â”œâ”€â”€ config_[convert.py](http://convert.py)      # é…ç½®è½¬æ¢
â”‚   â”‚   â”œâ”€â”€ log_[analyzer.py](http://analyzer.py)        # æ—¥å¿—åˆ†æ
â”‚   â”‚   â””â”€â”€ golden_sample_[test.py](http://test.py)  # Golden Sample æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“ ci/                      # CI/CD è„šæœ¬
â”‚       â”œâ”€â”€ [lint.sh](http://lint.sh)
â”‚       â”œâ”€â”€ [test.sh](http://test.sh)
â”‚       â””â”€â”€ [coverage.sh](http://coverage.sh)
â”‚
â”œâ”€â”€ ğŸ“ tests/                       # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_scratch_detector.cpp
â”‚   â”‚   â”œâ”€â”€ test_crack_detector.cpp
â”‚   â”‚   â”œâ”€â”€ test_defect_scorer.cpp
â”‚   â”‚   â”œâ”€â”€ test_config_validator.cpp
â”‚   â”‚   â””â”€â”€ test_spsc_queue.cpp
â”‚   â”œâ”€â”€ ğŸ“ integration/             # é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_detect_pipeline.cpp
â”‚   â”‚   â”œâ”€â”€ test_database.cpp
â”‚   â”‚   â””â”€â”€ test_camera_mock.cpp
â”‚   â”œâ”€â”€ ğŸ“ performance/             # æ€§èƒ½æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ bench_detectors.cpp
â”‚   â”‚   â””â”€â”€ bench_dnn.cpp
â”‚   â”œâ”€â”€ ğŸ“ fixtures/                # æµ‹è¯•æ•°æ®
â”‚   â”‚   â”œâ”€â”€ ğŸ“ images/
â”‚   â”‚   â”‚   â”œâ”€â”€ ok_sample_001.png
â”‚   â”‚   â”‚   â”œâ”€â”€ scratch_mild_001.png
â”‚   â”‚   â”‚   â”œâ”€â”€ crack_severe_001.png
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ ğŸ“ configs/
â”‚   â”‚       â””â”€â”€ test_config.json
â”‚   â””â”€â”€ CMakeLists.txt
â”‚
â”œâ”€â”€ ğŸ“ docs/                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ [README.md](http://README.md)                  # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ [BUILD.md](http://BUILD.md)                   # æ„å»ºæŒ‡å—
â”‚   â”œâ”€â”€ [DEPLOY.md](http://DEPLOY.md)                  # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ [API.md](http://API.md)                     # API æ–‡æ¡£
â”‚   â”œâ”€â”€ [ARCHITECTURE.md](http://ARCHITECTURE.md)            # æ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ [CHANGELOG.md](http://CHANGELOG.md)               # å˜æ›´æ—¥å¿—
â”‚   â”œâ”€â”€ [CONTRIBUTING.md](http://CONTRIBUTING.md)            # è´¡çŒ®æŒ‡å—
â”‚   â””â”€â”€ ğŸ“ images/                  # æ–‡æ¡£å›¾ç‰‡
â”‚       â””â”€â”€ architecture.png
â”‚
â”œâ”€â”€ ğŸ“ third_party/                 # ç¬¬ä¸‰æ–¹ä¾èµ–
â”‚   â”œâ”€â”€ ğŸ“ spdlog/                  # æ—¥å¿—åº“ (submodule)
â”‚   â”œâ”€â”€ ğŸ“ json/                    # nlohmann/json (submodule)
â”‚   â”œâ”€â”€ ğŸ“ googletest/              # Google Test (submodule)
â”‚   â””â”€â”€ CMakeLists.txt
â”‚
â”œâ”€â”€ ğŸ“ platform/                    # å¹³å°ç‰¹å®šä»£ç 
â”‚   â”œâ”€â”€ ğŸ“ linux/
â”‚   â”‚   â”œâ”€â”€ systemd/
â”‚   â”‚   â”‚   â””â”€â”€ defect-inspector.service
â”‚   â”‚   â””â”€â”€ udev/
â”‚   â”‚       â””â”€â”€ 99-camera.rules
â”‚   â””â”€â”€ ğŸ“ windows/
â”‚       â”œâ”€â”€ installer.nsi          # NSIS å®‰è£…è„šæœ¬
â”‚       â””â”€â”€ defect-inspector.rc    # èµ„æºæ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ data/                        # è¿è¡Œæ—¶æ•°æ®ï¼ˆgitignoreï¼‰
â”‚   â”œâ”€â”€ ğŸ“ db/                      # æ•°æ®åº“æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ inspection.db
â”‚   â”œâ”€â”€ ğŸ“ logs/                    # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ ğŸ“ images/                  # æ£€æµ‹å›¾åƒ
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ng/                  # NG å›¾åƒ
â”‚   â”‚   â””â”€â”€ ğŸ“ archive/             # å½’æ¡£å›¾åƒ
â”‚   â”œâ”€â”€ ğŸ“ backup/                  # å¤‡ä»½æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“ export/                  # å¯¼å‡ºæ•°æ®
â”‚
â”œâ”€â”€ ğŸ“ .github/                     # GitHub é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ workflows/
â”‚   â”‚   â”œâ”€â”€ build.yml              # CI æ„å»º
â”‚   â”‚   â”œâ”€â”€ test.yml               # CI æµ‹è¯•
â”‚   â”‚   â””â”€â”€ release.yml            # å‘å¸ƒæµç¨‹
â”‚   â”œâ”€â”€ ISSUE_[TEMPLATE.md](http://TEMPLATE.md)
â”‚   â””â”€â”€ PULL_REQUEST_[TEMPLATE.md](http://TEMPLATE.md)
â”‚
â”œâ”€â”€ CMakeLists.txt                 # ä¸» CMake é…ç½®
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .gitmodules                    # Git å­æ¨¡å—
â”œâ”€â”€ .clang-format                  # ä»£ç æ ¼å¼åŒ–é…ç½®
â”œâ”€â”€ .clang-tidy                    # é™æ€åˆ†æé…ç½®
â”œâ”€â”€ LICENSE
â””â”€â”€ [README.md](http://README.md)
```

---

## 2. ç›®å½•åˆ›å»ºè„šæœ¬

### 2.1 Linux/macOS

```bash
#!/bin/bash
# create_[project.sh](http://project.sh) - åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

PROJECT_NAME="defect-inspector"

echo "Creating project: $PROJECT_NAME"
mkdir -p $PROJECT_NAME && cd $PROJECT_NAME

# CMake æ¨¡å—
mkdir -p cmake
touch cmake/{FindOpenCV.cmake,FindQt6.cmake,toolchain-aarch64.cmake,version.cmake}

# æºä»£ç ç›®å½•
mkdir -p src/{app,core,algorithm,hal,ui/{widgets,dialogs,views},data,network,common}
mkdir -p include/defect_inspector

# æºæ–‡ä»¶å ä½
touch src/app/{main.cpp,Application.h,Application.cpp,[version.h.in](http://version.h.in)}
touch src/core/{DetectPipeline,DefectJudge,ResultManager,BatchManager,WorkflowController}.{h,cpp}
touch src/algorithm/{IDefectDetector.h,ScratchDetector,CrackDetector,ForeignDetector,DimensionDetector,DnnDetector,DefectScorer,ImagePreprocessor,ROIManager}.{h,cpp} 2>/dev/null || true
touch src/algorithm/IDefectDetector.h
for f in ScratchDetector CrackDetector ForeignDetector DimensionDetector DnnDetector DefectScorer ImagePreprocessor ROIManager; do
    touch src/algorithm/${f}.h src/algorithm/${f}.cpp
done

touch src/hal/{ICamera.h,HikCamera,BaslerCamera,MockCamera,ILightController.h,SerialLight,IIOController.h,ModbusTCPClient,PLCController}.{h,cpp} 2>/dev/null || true
touch src/hal/ICamera.h src/hal/ILightController.h src/hal/IIOController.h
for f in HikCamera BaslerCamera MockCamera SerialLight ModbusTCPClient PLCController; do
    touch src/hal/${f}.h src/hal/${f}.cpp
done

touch src/ui/{MainWindow.h,MainWindow.cpp,MainWindow.ui}
for f in ImageView ROIEditor ResultCard ParamPanel SeverityBar StatisticsChart; do
    touch src/ui/widgets/${f}.h src/ui/widgets/${f}.cpp
done
for f in SettingsDialog CalibrationDialog LoginDialog UserManageDialog HistoryDialog AlarmDialog ModelManageDialog AboutDialog; do
    touch src/ui/dialogs/${f}.h src/ui/dialogs/${f}.cpp
done
for f in StatisticsView HistoryView SPCView; do
    touch src/ui/views/${f}.h src/ui/views/${f}.cpp
done

touch src/data/{DatabaseManager,InspectionDAO,DefectDAO,UserDAO,ConfigDAO,AuditLogger,DataExporter}.{h,cpp}
touch src/network/{MESClient,WebSocketServer,RESTServer,RemoteDiagnostic}.{h,cpp}
touch src/common/{Logger,ConfigManager,ConfigValidator,SystemWatchdog,PerformanceProfiler,ImageUtils,FileUtils,CryptoUtils}.{h,cpp}
touch src/common/{SPSCQueue.h,ThreadPool.h,Types.h}

touch include/defect_inspector/{export.h,types.h,api.h}

# é…ç½®æ–‡ä»¶
mkdir -p config/templates
touch config/{default.json,camera_hik.json,camera_basler.json,detectors.json,severity.json,plc_registers.json}
touch config/templates/{product_A.json,product_B.json}

# AI æ¨¡å‹
mkdir -p models
touch models/model_info.json

# èµ„æºæ–‡ä»¶
mkdir -p resources/{icons,images,qss,translations}
touch resources/{resources.qrc}
touch resources/qss/{light.qss,dark.qss}
touch resources/translations/{app_zh_CN.ts,app_en_US.ts}

# è„šæœ¬
mkdir -p scripts/{build,deploy,tools,ci}
touch scripts/build/{build_[linux.sh](http://linux.sh),build_windows.bat,build_[arm.sh](http://arm.sh),[package.sh](http://package.sh)}
touch scripts/deploy/{[install.sh](http://install.sh),[uninstall.sh](http://uninstall.sh),[backup.sh](http://backup.sh),[restore.sh](http://restore.sh)}
touch scripts/tools/{db_[migrate.py](http://migrate.py),config_[convert.py](http://convert.py),log_[analyzer.py](http://analyzer.py),golden_sample_[test.py](http://test.py)}
touch scripts/ci/{[lint.sh](http://lint.sh),[test.sh](http://test.sh),[coverage.sh](http://coverage.sh)}
chmod +x scripts/**/*.sh 2>/dev/null || true

# æµ‹è¯•
mkdir -p tests/{unit,integration,performance,fixtures/{images,configs}}
touch tests/unit/{test_scratch_detector,test_crack_detector,test_defect_scorer,test_config_validator,test_spsc_queue}.cpp
touch tests/integration/{test_detect_pipeline,test_database,test_camera_mock}.cpp
touch tests/performance/{bench_detectors,bench_dnn}.cpp
touch tests/CMakeLists.txt
touch tests/fixtures/configs/test_config.json

# æ–‡æ¡£
mkdir -p docs/images
touch docs/{[README.md](http://README.md),[BUILD.md](http://BUILD.md),[DEPLOY.md](http://DEPLOY.md),[API.md](http://API.md),[ARCHITECTURE.md](http://ARCHITECTURE.md),[CHANGELOG.md](http://CHANGELOG.md),[CONTRIBUTING.md](http://CONTRIBUTING.md)}

# ç¬¬ä¸‰æ–¹ä¾èµ–
mkdir -p third_party/{spdlog,json,googletest}
touch third_party/CMakeLists.txt

# å¹³å°ç‰¹å®š
mkdir -p platform/linux/{systemd,udev}
mkdir -p platform/windows
touch platform/linux/systemd/defect-inspector.service
touch platform/linux/udev/99-camera.rules
touch platform/windows/{installer.nsi,defect-inspector.rc}

# è¿è¡Œæ—¶æ•°æ®ç›®å½•
mkdir -p data/{db,logs,images/{ng,archive},backup,export}

# GitHub
mkdir -p .github/workflows
touch .github/workflows/{build.yml,test.yml,release.yml}
touch .github/{ISSUE_[TEMPLATE.md](http://TEMPLATE.md),PULL_REQUEST_[TEMPLATE.md](http://TEMPLATE.md)}

# æ ¹ç›®å½•æ–‡ä»¶
touch CMakeLists.txt .gitignore .gitmodules .clang-format .clang-tidy LICENSE [README.md](http://README.md)

echo "âœ… Project structure created successfully!"
echo "ğŸ“ Total directories: $(find . -type d | wc -l)"
echo "ğŸ“„ Total files: $(find . -type f | wc -l)"
```

### 2.2 Windows (PowerShell)

```powershell
# create_[project.ps](http://project.ps)1 - åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„

$PROJECT_NAME = "defect-inspector"

Write-Host "Creating project: $PROJECT_NAME" -ForegroundColor Green
New-Item -ItemType Directory -Force -Path $PROJECT_NAME | Out-Null
Set-Location $PROJECT_NAME

# ç›®å½•åˆ—è¡¨
$directories = @(
    "cmake",
    "src/app", "src/core", "src/algorithm", "src/hal",
    "src/ui/widgets", "src/ui/dialogs", "src/ui/views",
    "src/data", "src/network", "src/common",
    "include/defect_inspector",
    "config/templates",
    "models",
    "resources/icons", "resources/images", "resources/qss", "resources/translations",
    "scripts/build", "scripts/deploy", "scripts/tools", "scripts/ci",
    "tests/unit", "tests/integration", "tests/performance",
    "tests/fixtures/images", "tests/fixtures/configs",
    "docs/images",
    "third_party/spdlog", "third_party/json", "third_party/googletest",
    "platform/linux/systemd", "platform/linux/udev", "platform/windows",
    "data/db", "data/logs", "data/images/ng", "data/images/archive",
    "data/backup", "data/export",
    ".github/workflows"
)

foreach ($dir in $directories) {
    New-Item -ItemType Directory -Force -Path $dir | Out-Null
}

# åˆ›å»ºå ä½æ–‡ä»¶
$files = @(
    "CMakeLists.txt", ".gitignore", ".gitmodules", ".clang-format", ".clang-tidy",
    "LICENSE", "[README.md](http://README.md)",
    "cmake/FindOpenCV.cmake", "cmake/FindQt6.cmake", "cmake/toolchain-aarch64.cmake",
    "src/app/main.cpp", "src/app/Application.h", "src/app/Application.cpp",
    "config/default.json", "config/detectors.json", "config/severity.json",
    "resources/resources.qrc", "resources/qss/light.qss", "resources/qss/dark.qss",
    "docs/[README.md](http://README.md)", "docs/[BUILD.md](http://BUILD.md)", "docs/[DEPLOY.md](http://DEPLOY.md)", "docs/[API.md](http://API.md)",
    "tests/CMakeLists.txt", "third_party/CMakeLists.txt"
)

foreach ($file in $files) {
    New-Item -ItemType File -Force -Path $file | Out-Null
}

Write-Host "âœ… Project structure created successfully!" -ForegroundColor Green
$dirCount = (Get-ChildItem -Recurse -Directory | Measure-Object).Count
$fileCount = (Get-ChildItem -Recurse -File | Measure-Object).Count
Write-Host "ğŸ“ Total directories: $dirCount"
Write-Host "ğŸ“„ Total files: $fileCount"
```

---

## 3. æ ¸å¿ƒé…ç½®æ–‡ä»¶æ¨¡æ¿

### 3.1 CMakeLists.txt (æ ¹ç›®å½•)

```
cmake_minimum_required(VERSION 3.20)

# ç‰ˆæœ¬ä¿¡æ¯
set(PROJECT_VERSION_MAJOR 1)
set(PROJECT_VERSION_MINOR 0)
set(PROJECT_VERSION_PATCH 0)

project(defect-inspector
    VERSION ${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}.${PROJECT_VERSION_PATCH}
    LANGUAGES CXX
)

# C++ æ ‡å‡†
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# ç¼–è¯‘é€‰é¡¹
option(BUILD_TESTS "Build unit tests" ON)
option(BUILD_DOCS "Build documentation" OFF)
option(ENABLE_DNN "Enable DNN detector" ON)
option(USE_CUDA "Use CUDA for DNN" OFF)

# è¾“å‡ºç›®å½•
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib)

# CMake æ¨¡å—è·¯å¾„
list(APPEND CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake)

# æŸ¥æ‰¾ä¾èµ–
find_package(Qt6 REQUIRED COMPONENTS
    Core Gui Widgets Network Sql Charts Concurrent
)
find_package(OpenCV 4.6 REQUIRED COMPONENTS
    core imgproc imgcodecs highgui dnn
)
find_package(spdlog REQUIRED)
find_package(nlohmann_json REQUIRED)

# Qt è‡ªåŠ¨åŒ–
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTORCC ON)
set(CMAKE_AUTOUIC ON)

# å­ç›®å½•
add_subdirectory(third_party)
add_subdirectory(src)

if(BUILD_TESTS)
    enable_testing()
    add_subdirectory(tests)
endif()

# å®‰è£…è§„åˆ™
install(TARGETS defect-inspector
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib
)

install(DIRECTORY config/ DESTINATION etc/defect-inspector)
install(DIRECTORY resources/ DESTINATION share/defect-inspector)

# CPack æ‰“åŒ…
set(CPACK_PACKAGE_NAME "defect-inspector")
set(CPACK_PACKAGE_VERSION ${PROJECT_VERSION})
set(CPACK_PACKAGE_VENDOR "Your Company")
include(CPack)
```

### 3.2 src/CMakeLists.txt

```
# æºæ–‡ä»¶æ”¶é›†
file(GLOB_RECURSE SOURCES
    "app/*.cpp"
    "core/*.cpp"
    "algorithm/*.cpp"
    "hal/*.cpp"
    "ui/*.cpp"
    "data/*.cpp"
    "network/*.cpp"
    "common/*.cpp"
)

file(GLOB_RECURSE HEADERS
    "app/*.h"
    "core/*.h"
    "algorithm/*.h"
    "hal/*.h"
    "ui/*.h"
    "data/*.h"
    "network/*.h"
    "common/*.h"
)

file(GLOB_RECURSE UI_FILES "ui/*.ui")
file(GLOB_RECURSE QRC_FILES "../resources/*.qrc")

# ç‰ˆæœ¬å¤´æ–‡ä»¶
configure_file(
    ${CMAKE_CURRENT_SOURCE_DIR}/app/[version.h.in](http://version.h.in)
    ${CMAKE_CURRENT_BINARY_DIR}/version.h
)

# å¯æ‰§è¡Œæ–‡ä»¶
add_executable(defect-inspector
    ${SOURCES}
    ${HEADERS}
    ${UI_FILES}
    ${QRC_FILES}
)

target_include_directories(defect-inspector PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}
    ${CMAKE_CURRENT_BINARY_DIR}
    ${CMAKE_SOURCE_DIR}/include
)

target_link_libraries(defect-inspector PRIVATE
    Qt6::Core
    Qt6::Gui
    Qt6::Widgets
    Qt6::Network
    Qt6::Sql
    Qt6::Charts
    Qt6::Concurrent
    ${OpenCV_LIBS}
    spdlog::spdlog
    nlohmann_json::nlohmann_json
)

# é¢„ç¼–è¯‘å¤´
target_precompile_headers(defect-inspector PRIVATE
    <QObject>
    <QString>
    <QVector>
    <opencv2/core.hpp>
    <memory>
    <vector>
    <string>
)

# Windows ç‰¹å®š
if(WIN32)
    set_target_properties(defect-inspector PROPERTIES
        WIN32_EXECUTABLE TRUE
    )
endif()
```

### 3.3 .gitignore

```
# Build
build/
cmake-build-*/
*.o
*.obj
*.exe
*.dll
*.so
*.dylib
*.a
*.lib

# IDE
.idea/
.vscode/
*.user
*.pro.user*
.qmake.stash

# Runtime data
data/db/
data/logs/
data/images/
data/backup/
data/export/

# OS
.DS_Store
Thumbs.db

# Dependencies (if not using submodules)
third_party/*/
!third_party/CMakeLists.txt

# Temporary
*.tmp
*.temp
*.swp
*~

# Models (large files)
models/*.onnx
models/*.engine
models/*.bin
!models/model_info.json

# Generated
moc_*
ui_*
qrc_*
```

### 3.4 .clang-format

```yaml
---
Language: Cpp
BasedOnStyle: Google
IndentWidth: 4
TabWidth: 4
UseTab: Never
ColumnLimit: 100

# å‘½åç©ºé—´ä¸ç¼©è¿›
NamespaceIndentation: None

# å¤§æ‹¬å·
BreakBeforeBraces: Attach
AllowShortFunctionsOnASingleLine: Inline
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false

# æŒ‡é’ˆå¯¹é½
PointerAlignment: Left
ReferenceAlignment: Left

# include æ’åº
SortIncludes: CaseInsensitive
IncludeBlocks: Regroup
IncludeCategories:
  - Regex: '^<Q'
    Priority: 2
  - Regex: '^<opencv2/'
    Priority: 3
  - Regex: '^<'
    Priority: 4
  - Regex: '"'
    Priority: 1

# å…¶ä»–
AlignConsecutiveAssignments: false
AlignConsecutiveDeclarations: false
AlignTrailingComments: true
SpaceAfterCStyleCast: false
SpaceBeforeParens: ControlStatements
...
```

---

## 4. æ¨¡å—ä¾èµ–å…³ç³»

```mermaid
flowchart TB
    subgraph UI["UI å±‚"]
        MW[MainWindow]
        DLG[Dialogs]
        WDG[Widgets]
    end
    
    subgraph Core["æ ¸å¿ƒä¸šåŠ¡å±‚"]
        DP[DetectPipeline]
        DJ[DefectJudge]
        RM[ResultManager]
    end
    
    subgraph Algo["ç®—æ³•å±‚"]
        SD[ScratchDetector]
        CD[CrackDetector]
        FD[ForeignDetector]
        DD[DimensionDetector]
        DNN[DnnDetector]
        DS[DefectScorer]
    end
    
    subgraph HAL["ç¡¬ä»¶æŠ½è±¡å±‚"]
        CAM[ICamera]
        PLC[PLCController]
        LIGHT[LightController]
    end
    
    subgraph Data["æ•°æ®å±‚"]
        DB[DatabaseManager]
        DAO[DAOs]
        AL[AuditLogger]
    end
    
    subgraph Common["å…¬å…±æ¨¡å—"]
        LOG[Logger]
        CFG[ConfigManager]
        WD[Watchdog]
    end
    
    UI --> Core
    Core --> Algo
    Core --> HAL
    Core --> Data
    Algo --> Common
    HAL --> Common
    Data --> Common
    UI --> Common
```

---

## 5. å¿«é€Ÿå¼€å§‹

### 5.1 å…‹éš†å¹¶åˆå§‹åŒ–

```bash
# å…‹éš†é¡¹ç›®
git clone [https://github.com/yourcompany/defect-inspector.git](https://github.com/yourcompany/defect-inspector.git)
cd defect-inspector

# åˆå§‹åŒ–å­æ¨¡å—
git submodule update --init --recursive

# åˆ›å»ºè¿è¡Œæ—¶ç›®å½•
mkdir -p data/{db,logs,images/{ng,archive},backup,export}
```

### 5.2 æ„å»º (Linux)

```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build && cd build

# é…ç½®
cmake .. -DCMAKE_BUILD_TYPE=Release

# ç¼–è¯‘
cmake --build . -j$(nproc)

# è¿è¡Œ
./bin/defect-inspector
```

### 5.3 æ„å»º (Windows)

```powershell
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build; cd build

# é…ç½® (VS 2022)
cmake .. -G "Visual Studio 17 2022" -A x64

# ç¼–è¯‘
cmake --build . --config Release

# è¿è¡Œ
.\bin\Release\defect-inspector.exe
```